<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Barcode POS Scanner by Kel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <style>
    body{
      font-family:Arial,sans-serif;
      margin:0;background:#0f1720;color:#e6eef6;
      min-height:100vh;display:flex;justify-content:center;padding:20px;
    }
    .app{width:100%;max-width:800px}
    h1{text-align:center;margin-bottom:20px;font-size:22px}
    .card{
      background:#0b1220;border-radius:12px;padding:14px;margin-bottom:20px;
    }
    #interactive{
      position:relative;width:100%;max-width:500px;margin:0 auto;
      border:2px solid rgba(255,255,255,0.1);border-radius:8px;overflow:hidden;
      aspect-ratio:3/2;background:#000;
    }
    video,canvas{
      width:100%;height:auto;object-fit:cover;display:block;
    }
    /* Scanner red line */
    .scan-line{
      position:absolute;top:0;left:0;width:100%;height:2px;
      background:red;animation:scan 2s linear infinite;
    }
    @keyframes scan {
      0%{top:0}
      50%{top:calc(100% - 2px)}
      100%{top:0}
    }
    select,button,input{
      padding:8px;margin:4px 0;border-radius:8px;border:none;width:100%;
    }
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.1)}
    tfoot td{font-weight:bold}
    .grid{display:grid;gap:20px}
    @media(min-width:700px){.grid{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <div class="app">
    <h1>Barcode POS Scanner</h1>
    <div class="grid">
      <div class="card">
        <div id="interactive" class="viewport">
          <div class="scan-line"></div>
        </div>
        <button id="startBtn">Start Scanner</button>
        <button id="stopBtn">Stop Scanner</button>
        <p style="text-align:center">Detected: <strong id="detected">â€”</strong></p>
      </div>
      <div class="card">
        <form id="itemForm" onsubmit="return false;">
          <label>Barcode</label>
          <input id="barcodeInput" type="text" />
          <label>Name</label>
          <input id="nameInput" type="text" />
          <label>Qty</label>
          <input id="qtyInput" type="number" value="1" />
          <label>Price</label>
          <input id="priceInput" type="number" step="0.01" value="0" />
          <button id="addBtn">Add Item</button>
        </form>
        <table id="cartTable">
          <thead><tr><th>Barcode</th><th>Name</th><th>Qty</th><th>Price</th><th>Subtotal</th><th></th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td colspan="4">Total</td><td id="totalCell">0</td><td></td></tr></tfoot>
        </table>
      </div>
    </div>
  </div>
  <script>
    const detectedEl = document.getElementById('detected');
    const barcodeInput = document.getElementById('barcodeInput');
    const nameInput = document.getElementById('nameInput');
    const qtyInput = document.getElementById('qtyInput');
    const priceInput = document.getElementById('priceInput');
    const addBtn = document.getElementById('addBtn');
    const cartTableBody = document.querySelector('#cartTable tbody');
    const totalCell = document.getElementById('totalCell');
    const CART = [];

    function startScanner(){
      Quagga.init({
        inputStream:{
          name:"Live",
          type:"LiveStream",
          target:document.querySelector('#interactive'),
          constraints:{facingMode:"environment"}
        },
        decoder:{readers:["code_128_reader","ean_reader","ean_8_reader","upc_reader","upc_e_reader"]}
      },err=>{
        if(err){console.error(err);alert('Camera error');return}
        Quagga.start();
      });
      Quagga.onDetected(data=>{
        const code=data.codeResult.code;
        detectedEl.textContent=code;
        barcodeInput.value=code;
      });
    }
    function stopScanner(){Quagga.stop();}
    document.getElementById('startBtn').onclick=startScanner;
    document.getElementById('stopBtn').onclick=stopScanner;

    function renderCart(){
      cartTableBody.innerHTML='';
      let total=0;
      CART.forEach((it,idx)=>{
        const subtotal=it.qty*it.price;total+=subtotal;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${it.barcode}</td><td>${it.name}</td><td>${it.qty}</td><td>${it.price.toFixed(2)}</td><td>${subtotal.toFixed(2)}</td><td><button onclick="removeItem(${idx})">Remove</button></td>`;
        cartTableBody.appendChild(tr);
      });
      totalCell.textContent=total.toFixed(2);
    }
    function removeItem(i){CART.splice(i,1);renderCart();}

    addBtn.addEventListener('click',()=>{
      const barcode=barcodeInput.value.trim();
      const name=nameInput.value.trim()||'Unnamed';
      const qty=parseInt(qtyInput.value)||1;
      const price=parseFloat(priceInput.value)||0;
      if(!barcode)return alert('Scan or enter a barcode');
      CART.push({barcode,name,qty,price});
      renderCart();
      barcodeInput.value=nameInput.value='';qtyInput.value=1;priceInput.value=0;
    });
  </script>
</body>
</html>
